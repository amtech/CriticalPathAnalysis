syntax = "proto3";

option java_multiple_files = true;
option java_package = "kvprog";

package kvprog;

service KvStore {
  // Store KV.
  rpc Put (PutRequest) returns (PutReply) {}
  // Get existing KV.
  rpc Get (GetRequest) returns (GetReply) {}
  // Metadata about calls seen.
  rpc Calls (CallsRequest) returns (CallsReply) {}
}

message PutRequest {
  string key = 1;
  string value = 2;
}

message PutReply {
  enum Status {
    SUCCESS = 0;   // Operation succeeded
    NOTFOUND = 1;  // Key was not found
    SYSTEMERR = 2; // Some kind of system error occurred
  };

  Status status = 1;
}

message GetRequest {
  string key = 1;
}

message GetReply {
  enum Status {
    NOTFOUND = 0;   // Key was not found
    SYSTEMERR = 1; // Some kind of system error occurred
  };

  oneof ValOrStatus {
    string value = 1;
    Status failure = 2;
  }
}

message CallsRequest {
}

message CallsReply {
  repeated CallInfo call_info = 1;
}

message CallInfo {
  string call_type = 1;
  int64 count = 2;
}
